# harview

一个强大的 HAR（HTTP Archive）文件分析工具，用于分析网站性能和对比不同版本的性能差异。

## 功能特性

- 📊 **单文件夹分析**：分析指定文件夹中所有 HAR 文件的性能数据
- 🔄 **双文件夹对比**：对比两个文件夹中 HAR 文件的性能差异
- 🎯 **智能过滤**：可选择过滤静态资源文件（CSS、JS、图片等）
- 📈 **详细统计**：提供最慢 URL 排名、性能差异百分比等详细统计信息
- 🚀 **易于使用**：简单的命令行界面，支持多种使用场景

## 安装要求

- Python 3.6+
- 标准库（无需额外安装依赖）

## 使用方法

### 基本语法

```bash
python main.py [选项] <文件夹路径1> [文件夹路径2]
```

### 选项参数

- `--filter-assets` 或 `-f`：过滤静态资源文件（CSS、JS、图片、字体等）

### 使用场景

#### 1. 单文件夹性能分析

分析单个文件夹中所有 HAR 文件的性能：

```bash
# 基本分析
python main.py /path/to/har/folder

# 过滤静态资源的分析
python main.py --filter-assets /path/to/har/folder
```

**输出示例：**
```
开始单文件夹性能分析:
分析文件夹: /path/to/har/folder (folder_name)
已启用资源过滤: 将跳过图片、CSS、JS、字体、音视频等静态资源文件
--------------------------------------------------

在目录 '/path/to/har/folder' 中找到 3 个HAR文件:
  - test1.har
  - test2.har
  - test3.har

================================================================================
folder_name 文件夹最慢的前100个URL分析
================================================================================

共分析了 45 个URL

排名 最大响应时间(ms) URL
--------------------------------------------------------------------------------
1    2345.67         https://api.example.com/slow-endpoint
2    1234.56         https://example.com/heavy-page
3    987.65          https://api.example.com/data
...

================================================================================
统计信息:
总URL数量: 45
最慢URL: https://api.example.com/slow-endpoint (2345.67ms)
最快URL: https://example.com/fast-api (12.34ms)
最大响应时间: 2345.67ms
最小响应时间: 12.34ms
```

#### 2. 双文件夹性能对比

对比两个文件夹中 HAR 文件的性能差异：

```bash
# 基本对比
python main.py /path/to/before /path/to/after

# 过滤静态资源的对比
python main.py -f /path/to/before /path/to/after
```

**输出示例：**
```
开始文件夹对比分析:
第一组文件夹: /path/to/before (before)
第二组文件夹: /path/to/after (after)
已启用资源过滤: 将跳过图片、CSS、JS、字体、音视频等静态资源文件
--------------------------------------------------

================================================================================
after vs before 性能对比分析 (以before为基准)
================================================================================

共找到 32 个相同的URL进行对比

after比before慢最多的前100个URL (最大响应时间对比):
--------------------------------------------------------------------------------
排名 before最大(ms)  after最大(ms)   差异(ms)  差异(%)  URL
1    1234.56        1456.78         222.22    18.0%   https://api.example.com/endpoint1
2    987.65         1123.45         135.80    13.7%   https://example.com/page2
...

================================================================================
总体统计:
after比before慢的URL数量: 18 (56.3%)
after比before快的URL数量: 12 (37.5%)
after与before相同的URL数量: 2 (6.3%)
平均时间差异: 45.67ms
平均性能差异: 8.2%

结论: after最大响应时间平均比before慢 45.67ms (8.2%)
```

## HAR 文件准备

### 什么是 HAR 文件？

HAR（HTTP Archive）文件是一种用于记录浏览器与网站交互的标准格式，包含了所有 HTTP 请求和响应的详细信息。

### 如何生成 HAR 文件？

#### Chrome 浏览器：
1. 打开开发者工具（F12）
2. 切换到 "Network" 标签页
3. 勾选 "Preserve log"（保留日志）
4. 访问要测试的网页
5. 右键点击网络请求列表
6. 选择 "Save all as HAR with content"

#### Firefox 浏览器：
1. 打开开发者工具（F12）
2. 切换到 "网络" 标签页
3. 访问要测试的网页
4. 右键点击请求列表
5. 选择 "全部保存为 HAR"

### 文件夹结构建议

```
project/
├── before/          # 优化前的 HAR 文件
│   ├── test1.har
│   ├── test2.har
│   └── test3.har
└── after/           # 优化后的 HAR 文件
    ├── test1.har
    ├── test2.har
    └── test3.har
```

## 静态资源过滤

使用 `--filter-assets` 参数可以过滤以下类型的静态资源：

### 文件扩展名过滤：
- **样式文件**：`.css`
- **脚本文件**：`.js`
- **图片文件**：`.svg`, `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, `.ico`
- **字体文件**：`.woff`, `.woff2`, `.ttf`, `.eot`, `.otf`
- **音视频文件**：`.mp3`, `.mp4`, `.avi`, `.mov`, `.wmv`, `.flv`
- **文档压缩文件**：`.pdf`, `.zip`, `.rar`, `.tar`, `.gz`

### 路径过滤：
- `/css/`, `/js/`, `/svg/`, `/images/`, `/img/`
- `/assets/`, `/static/`, `/fonts/`, `/media/`
- `_next/static` (Next.js 静态资源)

## 实际应用场景

### 1. 网站性能优化前后对比
```bash
# 对比优化前后的性能差异
python main.py --filter-assets ./before-optimization ./after-optimization
```

### 2. 不同版本发布的性能对比
```bash
# 对比 v1.0 和 v2.0 的性能
python main.py ./v1.0-har ./v2.0-har
```

### 3. A/B 测试性能分析
```bash
# 对比 A/B 测试的性能差异
python main.py -f ./test-a ./test-b
```

### 4. 单次性能基准测试
```bash
# 分析当前版本的性能基准
python main.py --filter-assets ./current-performance
```

## 输出结果解读

### 单文件夹分析结果：
- **排名**：按最大响应时间降序排列
- **最大响应时间**：该 URL 在所有 HAR 文件中的最慢响应时间
- **统计信息**：包含总 URL 数量、最慢/最快 URL 等

### 双文件夹对比结果：
- **差异(ms)**：第二组比第一组慢/快的毫秒数
- **差异(%)**：相对于第一组的性能变化百分比
- **总体统计**：包含变慢/变快的 URL 数量和平均差异

## 注意事项

1. **文件格式**：确保 HAR 文件格式正确且完整
2. **文件大小**：大型 HAR 文件可能需要较长处理时间
3. **URL 匹配**：双文件夹对比只分析两组中都存在的相同 URL
4. **WebSocket 过滤**：工具会自动跳过 WebSocket 连接（ws:// 和 wss://）
5. **编码问题**：HAR 文件应使用 UTF-8 编码

## 故障排除

### 常见错误及解决方案：

**错误：目录不存在**
```
错误: 目录 '/path/to/folder' 不存在
```
- 检查路径是否正确
- 确保使用绝对路径或正确的相对路径

**警告：没有找到 HAR 文件**
```
警告: 目录 '/path/to/folder' 中没有找到HAR文件
```
- 确保文件夹中包含 `.har` 扩展名的文件
- 检查文件权限

**警告：无法处理文件**
```
警告: 无法处理文件 'test.har': [错误信息]
```
- 检查 HAR 文件是否损坏
- 确保文件是有效的 JSON 格式

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个工具！

## 许可证

本项目采用 MIT 许可证。